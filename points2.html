<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¨Ø­Ø« Ø§Ù„Ù†Ù‚Ø§Ø·</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
            background: linear-gradient(135deg, #87CEEB 0%, #E0F6FF 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 10px;
            font-size: 22px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            background-color: #4a90e2;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4A90E2;
        }

        .card-header-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-header h2 {
            color: #333;
            font-size: 16px;
            margin: 0;
        }

        .icon {
            background: #4A90E2;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }

        .refresh-btn {
            background: #4A90E2;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            white-space: nowrap;
        }

        .refresh-btn:hover {
            background: #357ABD;
        }

        /* Status Bar */
        .status-bar {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 12px;
            text-align: center;
        }

        .status-bar.error {
            background: #ffebee;
            color: #c62828;
        }

        /* Search Row */
        .search-row {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }

        .search-row select {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            background: white;
        }

        .search-row input {
            flex: 2;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .search-row select:focus,
        .search-row input:focus {
            outline: none;
            border-color: #4A90E2;
        }

        /* Results Info */
        .results-info {
            background: #f0f8ff;
            color: #4A90E2;
            padding: 8px 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 12px;
            text-align: center;
            display: none;
        }

        .results-info.show {
            display: block;
        }

        /* Table Container */
        .table-container {
            max-height: 500px;
            overflow-y: auto;
            border-radius: 8px;
            border: 1px solid #ddd;
            display: none;
        }

        .table-container.show {
            display: block;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 10px;
            text-align: right;
            font-size: 13px;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #4A90E2;
            color: white;
            position: sticky;
            top: 0;
            font-weight: 600;
            z-index: 10;
        }

        tr:hover {
            background: #f0f8ff;
        }

        td {
            color: #333;
        }

        .points-cell {
            font-weight: 600;
            color: #4A90E2;
            font-size: 14px;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .empty-state-text {
            font-size: 14px;
        }

        .no-results {
            text-align: center;
            padding: 30px;
            color: #666;
        }

        .loading {
            text-align: center;
            padding: 30px;
            color: #666;
            font-size: 13px;
        }

        /* Scrollbar Styling */
        .table-container::-webkit-scrollbar {
            width: 8px;
        }

        .table-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .table-container::-webkit-scrollbar-thumb {
            background: #4A90E2;
            border-radius: 4px;
        }

        .table-container::-webkit-scrollbar-thumb:hover {
            background: #357ABD;
        }

        /* Responsive */
        @media (max-width: 600px) {
            th, td {
                padding: 8px 5px;
                font-size: 11px;
            }

            .search-row {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>â­ Ø¨Ø­Ø« ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†Ù‚Ø§Ø·</h1>

        <!-- Status Bar -->
        <div class="status-bar" id="statusBar">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>

        <!-- Search Card -->
        <div class="card">
            <div class="card-header">
                <div class="card-header-right">
                    <span class="icon">ğŸ”</span>
                    <h2>Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ©</h2>
                </div>
                <button class="refresh-btn" onclick="loadPointsData()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
            </div>
            
            <!-- Search Row -->
            <div class="search-row">
                <select id="typeFilter" onchange="filterPoints()">
                    <option value="">ÙƒÙ„ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                </select>
                <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø«..." oninput="filterPoints()">
            </div>

            <!-- Results Info -->
            <div class="results-info" id="resultsInfo">
                Ø¹Ø±Ø¶ <strong id="resultCount">0</strong> Ù†ØªÙŠØ¬Ø©
            </div>

            <!-- Empty State -->
            <div class="empty-state" id="emptyState">
                <div class="empty-state-icon">â­</div>
                <div class="empty-state-text">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙÙ„ØªØ± Ø£Ùˆ ÙƒØªØ§Ø¨Ø© ÙÙŠ Ø®Ø§Ù†Ø© Ø§Ù„Ø¨Ø­Ø«</div>
            </div>

            <!-- Table -->
            <div class="table-container" id="tableContainer">
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ù†ÙˆØ¹</th>
                            <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                            <th>Ø§Ù„ÙˆØ²Ù† 1 Ø¬Ù…</th>
                            <th>Ø§Ù„Ù†Ù‚Ø§Ø·</th>
                        </tr>
                    </thead>
                    <tbody id="pointsTableBody">
                        <tr><td colspan="4" class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // CONFIGURATION
        // ========================================
        const POINTS_SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT8o1qHZUUOVnh4msa5fO6q-DvMIhefYJLmjdSvdkMuoLOd3GNOJqbKX_CagFhWzXmRbRx5AIxjuHKh/pub?gid=1778319106&single=true&output=csv';
        // Proxy removed - not needed for published sheets
        // ========================================

        let pointsDatabase = [];
        let pointTypes = [];

        // Load points data
        async function loadPointsData() {
            const statusBar = document.getElementById('statusBar');
            statusBar.className = 'status-bar';
            statusBar.textContent = 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...';

            try {
                // Fetch directly from Google (no proxy, no encoding needed)
                const response = await fetch(POINTS_SHEET_URL);
                
                if (!response.ok) throw new Error('Failed to fetch');

                const csvText = await response.text();
                pointsDatabase = parseCSV(csvText);
                
                // Extract unique types
                pointTypes = [...new Set(pointsDatabase.map(p => p.type).filter(t => t))].sort();
                populateTypeFilter();
                
                statusBar.textContent = 'âœ“ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
                
                // Cache
                localStorage.setItem('pointsDatabase', JSON.stringify(pointsDatabase));
                
            } catch (error) {
                console.error('Error:', error);
                
                const cached = localStorage.getItem('pointsDatabase');
                if (cached) {
                    pointsDatabase = JSON.parse(cached);
                    pointTypes = [...new Set(pointsDatabase.map(p => p.type).filter(t => t))].sort();
                    populateTypeFilter();
                    statusBar.textContent = 'âš  Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø©';
                } else {
                    statusBar.className = 'status-bar error';
                    statusBar.textContent = 'âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
                }
            }
        }

        // Parse CSV
        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const points = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = parseCSVLine(lines[i]);
                
                if (values.length >= 4) {
                    points.push({
                        type: values[0]?.trim() || '',
                        nearly_amount: values[1]?.trim() || '',
                        weight_1gm: values[2]?.trim() || '',
                        points: values[3]?.trim() || ''
                    });
                }
            }
            
            return points;
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current);
            return result;
        }

        // Populate type filter
        function populateTypeFilter() {
            const select = document.getElementById('typeFilter');
            select.innerHTML = '<option value="">ÙƒÙ„ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>';
            pointTypes.forEach(type => {
                select.innerHTML += `<option value="${type}">${type}</option>`;
            });
        }

        // Filter points
        function filterPoints() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            const selectedType = document.getElementById('typeFilter').value;
            
            const tableContainer = document.getElementById('tableContainer');
            const emptyState = document.getElementById('emptyState');
            const resultsInfo = document.getElementById('resultsInfo');

            // Show results only if there's a search term or type filter
            if (searchTerm || selectedType) {
                emptyState.style.display = 'none';
                
                let filtered = pointsDatabase;
                
                // Filter by type
                if (selectedType) {
                    filtered = filtered.filter(p => p.type === selectedType);
                }
                
                // Filter by any field containing search term
                if (searchTerm) {
                    filtered = filtered.filter(p => 
                        p.type.toLowerCase().includes(searchTerm) ||
                        p.nearly_amount.toLowerCase().includes(searchTerm) ||
                        p.weight_1gm.toLowerCase().includes(searchTerm) ||
                        p.points.toLowerCase().includes(searchTerm)
                    );
                }
                
                // Update results count
                document.getElementById('resultCount').textContent = filtered.length;
                resultsInfo.classList.add('show');
                
                if (filtered.length > 0) {
                    renderPointsTable(filtered);
                    tableContainer.classList.add('show');
                } else {
                    tableContainer.classList.remove('show');
                    showNoResults();
                }
            } else {
                // No search - show empty state
                tableContainer.classList.remove('show');
                resultsInfo.classList.remove('show');
                emptyState.style.display = 'block';
            }
        }

        // Render points table
        function renderPointsTable(points) {
            const tbody = document.getElementById('pointsTableBody');
            
            tbody.innerHTML = points.map(point => `
                <tr>
                    <td><strong>${point.type || '-'}</strong></td>
                    <td>${point.nearly_amount || '-'}</td>
                    <td>${point.weight_1gm || '-'}</td>
                    <td class="points-cell">${point.points || '-'}</td>
                </tr>
            `).join('');
        }

        // Show no results message
        function showNoResults() {
            const tbody = document.getElementById('pointsTableBody');
            tbody.innerHTML = '<tr><td colspan="4" class="no-results">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø«</td></tr>';
            document.getElementById('tableContainer').classList.add('show');
        }

        // Initialize
        loadPointsData();
    </script>
</body>
</html>
